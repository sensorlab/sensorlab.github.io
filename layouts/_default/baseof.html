{{/* Produce authors variable */}}
{{- $authors := slice -}}
{{- if .Params.author -}}
    {{- $authors = slice .Params.author -}}
{{- else if .Params.authors }}
    {{- $authors = .Params.authors -}}
{{- else if .Site.Params.author -}}
    {{- $authors = slice .Site.Params.author -}}
{{- end -}}
{{- .Scratch.Set "authors" $authors -}}

{{/* Produce summary */}}
{{- $summary := "" -}}
{{- if .Params.summary -}}
    {{- $summary = .Params.summary -}}
{{- else if .Params.abstract -}}
    {{- $summary = .Params.abstract -}}
{{- else if .IsPage -}}
    {{- $summary = .Summary -}}
{{- else if .Site.Params.description -}}
    {{- $summary = .Site.Params.description -}}
{{- end -}}
{{- .Scratch.Set "summary" $summary -}}

{{/* Produce stylesheets (CSS) */}}
{{- $opts := (dict "inlineImports" true "targetPath" "style.css" "outputStyle" "compressed" "enableSourceMap" true) -}}
{{- $css := resources.Get "styles/main.scss" | toCSS $opts | postCSS | minify | fingerprint -}}

{{/* Produce Javascript code */}}
{{- $opts := dict "noComments" true -}}
{{- $js := resources.Get "scripts/main.js" | babel $opts | js.Build "main.js" | minify | fingerprint -}}

<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}" class="no-js">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    {{ if .Site.Params.inlineCSS }}
    <style>{{ $css.Content | safeCSS }}</style>
    {{ else }}
    <link rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">
    {{ end }}

    <script type="text/javascript" src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" defer></script>

    <title>{{ if not .IsHome }}{{ .Params.name | default .Title }} | {{ end }}{{ site.Title }}</title>

    <!-- Just some meta tag on Hugo static site generator -->
    {{ hugo.Generator }}

    <!-- Tag with authors -->
    {{ with $authors }}
        <meta name="author" content="{{ delimit . ", " }}" />
    {{ end }}

    {{ with $summary }}
        <meta name="description" content="{{ plainify . }}" />
    {{ end }}


    {{ with .Site.Params.themeColor }}
        <meta name="theme-color" content="{{ . }}" />
    {{ end }}

    <!-- Keywords are ignore nowadays by search engines -->
    {{ if eq (getenv "HUGO_ENV") "production" | or (eq .Site.Params.env "production") }}
        <!-- robots; TODO: disable index on lists -->
        <meta name="robots" content="index,follow" />
    {{ else }}
        <meta name="robots" content="noindex,nofollow" />
    {{ end }}


    {{/* canonical links to alternative representations */}}
    <link rel="canonical" href="{{ .Permalink }}" />
    <link rel="alternate" hreflang="{{ site.LanguageCode | default "en-us" }}" href="{{ .Permalink }}" />
    {{ range .Translations }}
        <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}" />
    {{ end }}

    {{ range .AlternativeOutputFormats }}
        {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
    {{ end }}


    {{ block "schema-dot-org" . }}
        {{/* schema.org metadata differs for Nodes and Pages */}}
    {{ end }}
</head>
<body>
    {{- partial "header.html" . -}}
    {{- block "main" . }}{{- end }}
    {{- partial "footer.html" . -}}
</body>
</html>
