{{ define "main" }}
{{ $member := .Params }}


{{ $employed := true }}
{{ with .Params.date_end }}
    {{ with (time .) }}
        {{ $employed = .After now }}
    {{ end }}
{{ end }}


<main class="flex-fill container my-4" aria-role="main">
    <article>
        <header class="d-flex flex-column flex-sm-row align-items-center align-items-sm-start">
            {{ $resource := .Resources.GetMatch .Params.avatar }}
            {{ $img := $resource.Fill "200x200 jpeg q90" }}
            <img
                src="{{ $img.Permalink }}"
                width="{{ $img.Width }}"
                height="{{ $img.Height }}"
                class="rounded-3 mx-2"
                alt="Photo of {{ $member.title }}"
                loading="lazy"
            >
            <div class="px-2">
                <h2>
                    {{- with .Params.prefix -}}<small class="text-muted">{{ . }}</small>&nbsp;{{- end -}}
                    {{- .Params.name | default .Params.title -}}
                </h2>
                <div>
                    <strong>Role:</strong> {{ .Params.role -}}
                </div>

                {{- with $member.date_start -}}
                    <div><strong>Joined:</strong> {{ ( time . ).Format "January, 2006" }}</div>
                {{- end -}}


                {{- with $member.date_end -}}
                    <div><strong>Departed:</strong> {{ ( time . ).Format "Jan, 2006" }}</div>
                {{- end -}}
                
                {{ with $member.organizations }}
                <div>
                    <strong>Affiliations:</strong> 
                    {{ $list := slice }}
                    {{ range . }}
                        {{ $list = $list | append (printf "<a href='%s'>%s</a>" (.url | safeURL) .name) }}
                    {{ end }}

                    {{ delimit $list ", " }}
                </div>
                {{ end }}
                {{/*<p>Main research interests: {{ delimit $member.interests ", " ", and " }}</u>.</p>*/}}
            </div>
        </header>

        {{ if $member.interests }}
        <section class="mt-2">
            <h3>Main research interests:</h3>
            <p>{{ delimit $member.interests ", " ", and " }}</u>.</p>
        </section>
        {{ end }}

        {{ with .Content }}
        <section class="mt-2">
            <h3>Bio:</h3>
            {{ . }}
        </section>
        {{ end }}


    {{ if $member.cobiss }}

        {{ $publications := slice }}
        {{ range $publication := $.Site.Data.cobiss }}
            {{ range $author := $publication.authors }}
                {{ if eq (int $author.cobiss_id) (int $member.cobiss) }}
                    {{ $publications = $publications | append $publication }}
                {{ end }}
            {{ end }}
        {{ end }}


        



        {{ if $publications }}
            <section>
                <h3>Publications:</h3>
                {{ $p := slice "1.01" "1.08" "preprint" }}
                <ul class="list-group list-group-flush">
                
                {{ range $publication := where $publications ".code" "in" $p }}
                    <li class="list-group-item publication">
                        <div class="title"><strong>{{ .title | title }}</strong></div>
                        
                        <div class="authors">
                            {{- $authors := slice -}}
                            {{ range $author := $publication.authors -}}
                                {{- if eq (int $author.cobiss_id) (int $member.cobiss) -}}
                                    {{- $authors = $authors | append (printf "<strong><u>%s</u></strong>" ($author.name)) -}}
                                {{- else -}}
                                    {{- $authors = $authors | append (printf "%s" ($author.name)) -}}
                                {{- end -}}
                            {{- end -}}
                            
                            {{- delimit $authors ", " ", and " -}}
                        
                        </div>

                        {{ if or .journal .conference }}
                            <div class="publication">{{ .journal | default .conference }}, {{ .year }}</div>
                        {{ end }}
                    
                        <ul class="list-inline">
                            {{- if and .cobiss_id .cobiss_url -}}
                            <li class="list-inline-item">
                                <a class="badge bg-cobiss text-white link-unstyled" href="{{ .cobiss_url | safeURL }}">COBISS:&nbsp;{{ .cobiss_id }}</a>
                            </li>
                            {{- end -}}
                            {{- if .doi -}}
                            <li class="list-inline-item">
                                <a class="badge bg-doi text-black link-unstyled" href="https://doi.org/{{ .doi }}">DOI:&nbsp;{{ .doi }}</a>
                            </li>
                            {{- end -}}
                            {{- if and .arxiv_id .arxiv_url }}
                            <li class="list-inline-item">
                                <a class="badge bg-arxiv text-white link-unstyled" href="{{ .arxiv_url | safeURL }}">arXiv:{{ .arxiv_id }}</a>
                            </li>
                            {{- end -}}
                        </ul>
                    </li>
                {{ end }}
                </ul>
            </section>

        {{ end }}
    {{ end }}


    </article>
</main>
{{ end }}
